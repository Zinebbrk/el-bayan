# Testing Guide: Assessments & Games Backend Integration

This guide will help you test the newly integrated Assessments and Games components.

---

## Prerequisites

### 1. Database Setup
Make sure your Supabase database has the required tables and seed data:

```bash
# Run migrations if not already done
# Check that these tables exist:
# - assessments
# - assessment_sessions
# - game_sessions
# - user_profiles
```

### 2. Seed Data
Ensure you have assessment data in the database:

```sql
-- Check if assessments exist
SELECT * FROM assessments;

-- If empty, you may need to add some test assessments
INSERT INTO assessments (title, topic, difficulty, estimated_time_minutes) VALUES
  ('Noun Cases Assessment', 'noun-cases', 'medium', 20),
  ('Verb Conjugation Quiz', 'verb-conjugation', 'easy', 25),
  ('Iʿrāb Analysis Test', 'harakāt', 'hard', 15),
  ('Sentence Structure Quiz', 'sentence-structure', 'medium', 18);
```

### 3. Environment Variables
Ensure your `.env` file has:
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 4. Start the Application
```bash
npm run dev
```

---

## Testing Assessments Component

### Test 1: View Assessments List

**Steps:**
1. Log in to the application
2. Navigate to "Assessments" from the sidebar
3. Wait for the page to load

**Expected Results:**
- ✅ Page loads without errors
- ✅ Shows "Assessments & Quizzes" header
- ✅ Displays statistics cards:
  - Average Score (may be 0% if no assessments completed)
  - Completed count
  - Perfect Scores count
- ✅ Shows list of available assessments from database
- ✅ Each assessment shows:
  - Title
  - Difficulty badge (Beginner/Intermediate/Advanced)
  - Number of questions
  - Estimated time
  - "Start" or "Retake" button

**What to Check:**
- No console errors
- Loading spinner appears briefly, then disappears
- Assessments are fetched from database (not hardcoded)

---

### Test 2: Start an Assessment

**Steps:**
1. Click "Start" on any assessment
2. Wait for questions to load

**Expected Results:**
- ✅ Assessment session is created in database
- ✅ Questions appear (generated by AI service)
- ✅ Timer starts counting
- ✅ Progress bar shows "Question 1 of X"
- ✅ Question text is displayed
- ✅ Multiple choice options are shown

**What to Check:**
- Check browser console for any errors
- Check Supabase dashboard → `assessment_sessions` table:
  - New row should be created
  - `user_id` matches your user
  - `assessment_id` matches the assessment
  - `questions` field contains question array
  - `answers` field is empty array
  - `completed_at` is null

---

### Test 3: Answer Questions

**Steps:**
1. Select an answer for the current question
2. Click "Next Question"
3. Repeat for all questions
4. On the last question, click "Finish Assessment"

**Expected Results:**
- ✅ Selected answer is highlighted
- ✅ Can navigate forward and backward
- ✅ Progress bar updates correctly
- ✅ Answers are tracked in state
- ✅ On finish, assessment is submitted

**What to Check:**
- Answers are stored in component state
- Can go back and change answers
- Progress percentage is accurate

---

### Test 4: View Results

**Steps:**
1. Complete an assessment (finish all questions)
2. Wait for results page to load

**Expected Results:**
- ✅ Results page shows:
  - Score percentage (e.g., "85%")
  - Number of correct answers
  - Number of incorrect answers
  - Time taken
- ✅ Shows review section for incorrect answers (if any)
- ✅ Each incorrect answer shows:
  - The question
  - Your answer
  - Correct answer
  - Explanation

**What to Check:**
- Check Supabase dashboard → `assessment_sessions`:
  - `score` field is populated
  - `answers` array contains all answers
  - `completed_at` timestamp is set
- Score calculation is correct (correct answers / total questions * 100)

---

### Test 5: View Statistics Update

**Steps:**
1. Complete an assessment
2. Go back to Assessments list page
3. Check statistics cards

**Expected Results:**
- ✅ Average score updates (if multiple assessments)
- ✅ Completed count increases
- ✅ Perfect scores count increases (if score is 100%)
- ✅ Best score shown on assessment card (if retaking)

**What to Check:**
- Statistics are recalculated from database
- Best scores are fetched and displayed

---

### Test 6: Assessment History

**Steps:**
1. Complete multiple assessments
2. Go to Assessments page
3. Scroll to "Recent Activity" section

**Expected Results:**
- ✅ Shows list of completed assessments
- ✅ Each shows:
  - Assessment title
  - Completion date
  - Score percentage
  - Color-coded icon (green/yellow/red based on score)

**What to Check:**
- Only completed assessments appear
- Most recent first
- Limited to 5 most recent

---

## Testing Games Component

### Test 1: View Games List

**Steps:**
1. Log in to the application
2. Navigate to "Games" from the sidebar
3. Wait for the page to load

**Expected Results:**
- ✅ Page loads without errors
- ✅ Shows "Gamified Learning" header
- ✅ Displays statistics cards:
  - Total XP (from user profile)
  - Current Level (from user profile)
  - Games Played (from game stats)
  - Day Streak (from user profile)
- ✅ Shows grid of available games
- ✅ Each game shows:
  - Icon
  - Difficulty badge
  - XP reward
  - Description
  - "Play Now" button

**What to Check:**
- No console errors
- Loading spinner appears briefly
- Stats are fetched from database (not hardcoded)

---

### Test 2: Start a Game

**Steps:**
1. Click "Play Now" on any game (e.g., "Build the Sentence")
2. Wait for game to load

**Expected Results:**
- ✅ Game session is created in database
- ✅ Game interface appears
- ✅ Shows:
  - Game title
  - Current level
  - Score/points
  - Game instructions
  - Word bank (for Build the Sentence)

**What to Check:**
- Check Supabase dashboard → `game_sessions` table:
  - New row created
  - `user_id` matches your user
  - `game_type` matches the game
  - `game_data` contains game content
  - `score` is 0
  - `xp_earned` is 0
  - `completed_at` is null

---

### Test 3: Play Game

**Steps:**
1. Click words from the word bank to build sentence
2. Arrange words in correct order
3. Click "Check Answer"

**Expected Results:**
- ✅ Words move from bank to sentence area
- ✅ Can remove words from sentence
- ✅ "Check Answer" button is disabled until all words are used
- ✅ On correct answer:
  - Score increases
  - Level increases
  - Words reset for next level
- ✅ On incorrect answer:
  - Words reset
  - Can try again

**What to Check:**
- Game logic works correctly
- Score tracking works
- Level progression works

---

### Test 4: Complete Game

**Steps:**
1. Complete 3 levels of the game
2. Game should auto-submit

**Expected Results:**
- ✅ Game session is updated in database
- ✅ XP is awarded to user
- ✅ Returns to games list
- ✅ Statistics update

**What to Check:**
- Check Supabase dashboard:
  - `game_sessions` table:
    - `score` is populated
    - `xp_earned` is calculated (50% of score)
    - `completed_at` is set
  - `user_profiles` table:
    - `xp` increased
    - `current_level` may increase if XP threshold reached
- Check browser console for badge notifications (if any badges earned)

---

### Test 5: View Updated Statistics

**Steps:**
1. Complete a game
2. Go back to Games list page
3. Check statistics cards

**Expected Results:**
- ✅ Total XP increases
- ✅ Current Level may increase (if XP threshold reached)
- ✅ Games Played count increases
- ✅ All stats reflect real database values

**What to Check:**
- Stats are fetched fresh from database
- No hardcoded values

---

## Common Issues & Troubleshooting

### Issue: "No assessments available yet"

**Cause:** No assessments in database

**Solution:**
```sql
-- Add test assessments
INSERT INTO assessments (title, topic, difficulty, estimated_time_minutes) VALUES
  ('Test Assessment', 'noun-cases', 'easy', 10);
```

---

### Issue: "Error fetching assessments"

**Cause:** Database connection issue or RLS policy blocking

**Solution:**
1. Check Supabase connection in browser console
2. Verify RLS policies allow read access to `assessments` table
3. Check network tab for failed requests

---

### Issue: Questions not loading

**Cause:** AI service error or assessment session creation failed

**Solution:**
1. Check browser console for errors
2. Verify `aiService.generateQuestions()` is working
3. Check `assessment_sessions` table for created session

---

### Issue: Score not saving

**Cause:** Assessment submission failed

**Solution:**
1. Check browser console for errors
2. Verify RLS policies allow update on `assessment_sessions`
3. Check that `sessionId` is valid

---

### Issue: XP not updating

**Cause:** Game submission or XP update failed

**Solution:**
1. Check browser console for errors
2. Verify `userService.addXP()` is called
3. Check RLS policies on `user_profiles` table
4. Verify user has permission to update their own profile

---

### Issue: Statistics showing 0 or incorrect values

**Cause:** No completed assessments/games or calculation error

**Solution:**
1. Complete at least one assessment/game
2. Refresh the page
3. Check database directly to verify data exists

---

## Database Verification Queries

### Check Assessments
```sql
SELECT * FROM assessments;
```

### Check Assessment Sessions
```sql
SELECT 
  as.*,
  a.title as assessment_title
FROM assessment_sessions as
JOIN assessments a ON a.id = as.assessment_id
WHERE as.user_id = 'your-user-id'
ORDER BY as.created_at DESC;
```

### Check Game Sessions
```sql
SELECT * FROM game_sessions
WHERE user_id = 'your-user-id'
ORDER BY created_at DESC;
```

### Check User Profile
```sql
SELECT id, name, xp, current_level, streak_days
FROM user_profiles
WHERE id = 'your-user-id';
```

### Check Game Statistics
```sql
SELECT 
  COUNT(*) as total_games,
  SUM(score) as total_score,
  AVG(score) as avg_score,
  MAX(score) as highest_score
FROM game_sessions
WHERE user_id = 'your-user-id'
  AND completed_at IS NOT NULL;
```

---

## Testing Checklist

### Assessments
- [ ] Page loads without errors
- [ ] Assessments list displays from database
- [ ] Statistics calculate correctly
- [ ] Can start an assessment
- [ ] Questions load and display
- [ ] Can answer questions
- [ ] Can navigate between questions
- [ ] Assessment submits successfully
- [ ] Results page displays correctly
- [ ] Score is saved to database
- [ ] Statistics update after completion
- [ ] History shows completed assessments

### Games
- [ ] Page loads without errors
- [ ] Games list displays
- [ ] Statistics show real user data
- [ ] Can start a game
- [ ] Game session creates in database
- [ ] Game play works correctly
- [ ] Score tracking works
- [ ] Game submits successfully
- [ ] XP is awarded
- [ ] User level may increase
- [ ] Statistics update after completion

---

## Next Steps

After testing, you may want to:
1. Add more assessment questions to the database
2. Implement leaderboard functionality
3. Add more game types
4. Enhance daily challenge feature
5. Add error handling and user feedback messages

---

## Notes

- The AI service currently uses mock data for questions and game content
- Leaderboard is a placeholder (returns empty array)
- Daily challenge UI is ready but needs backend completion
- All data is persisted to Supabase database
- RLS policies ensure users can only see their own data

